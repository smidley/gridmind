---
description: GridMind project context and development rules
globs: **/*
alwaysApply: true
---

# GridMind Development Rules

## FIRST: Read DEVELOPMENT.md
Before making ANY changes, read `/DEVELOPMENT.md` in the project root. It contains the full architecture, patterns, file map, git workflow, and backlog.

## Git Workflow (CRITICAL)
```bash
gh auth switch --user smidley    # BEFORE commit/push
git add -A && git commit -m "descriptive message"
git push origin main
gh auth switch --user tiltScott  # ALWAYS switch back
```
If push is rejected, use `git pull --rebase origin main` then push again.

## The User's Setup
- App runs on **Unraid** (not locally) — don't try to docker build/run locally
- After pushing, tell the user to update the container on Unraid
- Access via `https://gridmind.smidley.xyz` (HTTPS, behind reverse proxy)
- WebSocket may not be available (reverse proxy needs WS support)

## Key Patterns
- **Light/dark theme**: Light mode uses warm `stone` palette, dark mode uses cool `slate`. Example: `bg-stone-100 dark:bg-slate-950`, `text-stone-700 dark:text-slate-100`
- **Never bare dark classes**: always pair light + dark, e.g. `bg-stone-50 dark:bg-slate-900`, never bare `bg-slate-800`
- **Cards**: styled via `.card` class in index.css — `bg-white/70` light, `bg-slate-900` dark
- **Chart tooltips**: CSS-only in `index.css` — do NOT add inline `contentStyle`
- **API fetch**: always use `credentials: 'include'` for auth cookies
- **Detail pages**: use WebSocket primary + API polling fallback (useAutoRefresh for /status)
- **New pages**: add to navItems (desktop), moreItems in MobileNav (mobile), and Routes in App.tsx
- **WebSocket**: singleton in useWebSocket.ts — do NOT create new connections per page
- **Input fields**: `bg-stone-50 dark:bg-slate-900 border border-stone-300/60 dark:border-slate-700`

## Version Bump (REQUIRED on every push)
When committing changes that will be pushed to main, you MUST increment the version number.
- Use **semver**: bump PATCH for fixes/cleanup, MINOR for new features, MAJOR for breaking changes.
- Update ALL 3 files:
  1. `backend/config.py` — `app_version` string
  2. `frontend/package.json` — `"version"` field
  3. `frontend/src/App.tsx` — version string in the sidebar footer (search for `GridMind v`)
- Include the version bump in the same commit as the changes, not as a separate commit.

## Tesla API
- Battery power: negative = charging, positive = discharging
- Grid power: positive = importing, negative = exporting
- 408 = vehicle asleep (don't wake unless user asks)
- Wall Connector state from Powerwall live_status (no car wake needed)
